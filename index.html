<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>CSVã‹ã‚‰æ—¥éŸ“èª­ã¿ä¸Šã’</title>
<style>
 body { font-family: Arial; line-height: 1.8; padding: 20px; }
 button { padding: 8px 14px; margin-right: 6px; }
 textarea { width: 100%; height: 200px; font-size: 14px; }
</style>
</head>
<body>

<h2>CSV â†’ æ—¥æœ¬èª / éŸ“å›½èª èª­ã¿ä¸Šã’</h2>

<p>
  <button onclick="startTTS()">â–¶ èª­ã¿ä¸Šã’é–‹å§‹</button>
  <button onclick="stopTTS()">â¹ åœæ­¢</button>
</p>

<div id="status">CSV èª­ã¿è¾¼ã¿ä¸­...</div>

<textarea id="csvBox"></textarea>

<script>
let idx = 0;

// ğŸ”¹ ãƒšãƒ¼ã‚¸è¡¨ç¤ºæ™‚ã« CSV è‡ªå‹•èª­ã¿è¾¼ã¿
window.addEventListener("DOMContentLoaded", () => loadCsv());

async function loadCsv() {
  const status = document.getElementById("status");
  const box = document.getElementById("csvBox");

  try {
    const res = await fetch("kankoku.csv");
    if (!res.ok) {
      status.textContent = "ã‚¨ãƒ©ãƒ¼: HTTP " + res.status;
      return;
    }

    const text = await res.text();

    // ğŸ”¹ ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã¸è¡¨ç¤ºï¼ˆç·¨é›†å¯ï¼‰
    box.value = text.trim();

    status.textContent = "èª­ã¿è¾¼ã¿å®Œäº†ï¼ˆç·¨é›†ã—ã¦OKï¼‰";

  } catch (e) {
    status.textContent = "ã‚¨ãƒ©ãƒ¼: " + e.message;
    console.error(e);
  }
}

function speak(text, lang, cb){
  const u = new SpeechSynthesisUtterance(text);
  u.lang = lang;
  u.onend = cb;
  speechSynthesis.speak(u);
}

function startTTS(){
  speechSynthesis.cancel();
  idx = 0;
  speakNext();
}

function speakNext(){
  const lines = document.getElementById("csvBox").value
      .split("\n")
      .map(l => l.split(","))
      .filter(x => x.length >= 3);

  if (idx >= lines.length) return;

  const jp = lines[idx][0]; // æ—¥æœ¬èª
  const ko = lines[idx][2]; // éŸ“å›½èªï¼ˆãƒãƒ³ã‚°ãƒ«ï¼‰

  speak(jp, "ja-JP", () => {
    speak(ko, "ko-KR", () => {
      idx++;
      speakNext();
    });
  });
}

function stopTTS(){
  speechSynthesis.cancel();
}
</script>

</body>
</html>
