<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>CSVã‹ã‚‰æ—¥éŸ“èª­ã¿ä¸Šã’</title>
<style>
 body { font-family: Arial; line-height: 1.8; padding: 20px; }
 button { padding: 8px 14px; margin-right: 6px; }
</style>
</head>
<body>

<h2>CSV â†’ æ—¥æœ¬èª / éŸ“å›½èª èª­ã¿ä¸Šã’</h2>
<p>
  <button onclick="loadCsv()">ğŸ“¥ CSVã‚’èª­ã¿è¾¼ã‚€</button>
  <button onclick="startTTS()">â–¶ èª­ã¿ä¸Šã’é–‹å§‹</button>
  <button onclick="stopTTS()">â¹ åœæ­¢</button>
</p>

<div id="status">æœªèª­ã¿è¾¼ã¿</div>

<script>
let rows = [];
let idx = 0;

async function loadCsv() {
  const status = document.getElementById("status");
  try {
    const res = await fetch("kankoku.csv");
    if (!res.ok) {
      status.textContent = "ã‚¨ãƒ©ãƒ¼: HTTP " + res.status;
      return;
    }
    const text = await res.text();
    rows = text.trim().split("\n").map(l => l.split(","));
    status.textContent = `èª­ã¿è¾¼ã¿å®Œäº†ï¼š${rows.length} è¡Œ`;
  } catch (e) {
    status.textContent = "ã‚¨ãƒ©ãƒ¼: " + e.message;
    console.error(e);
  }
}

function speak(text, lang, cb){
  const u = new SpeechSynthesisUtterance(text);
  u.lang = lang;
  u.onend = cb;
  speechSynthesis.speak(u);
}

function startTTS(){
  if (!rows.length) {
    alert("å…ˆã« CSV ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„");
    return;
  }
  speechSynthesis.cancel();
  idx = 0;
  speakNext();
}

function speakNext(){
  if (idx >= rows.length) return;

  const jp = rows[idx][0]; // æ—¥æœ¬èª
  const ko = rows[idx][2]; // ãƒãƒ³ã‚°ãƒ«

  speak(jp, "ja-JP", () => {
    speak(ko, "ko-KR", () => {
      idx++;
      speakNext();
    });
  });
}

function stopTTS(){
  speechSynthesis.cancel();
}
</script>


</body>
</html>
